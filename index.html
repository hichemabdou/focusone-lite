<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Focus.One Lite</title>

<!-- Pro timeline (MIT) -->
<link rel="stylesheet" href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css">
<script src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>

<style>
  :root{
    --bg:#f6f7fb; --fg:#0f172a; --muted:#64748b; --line:#e5e7eb; --card:#ffffff;
    --primary:#0ea5e9; --primary-2:#60a5fa; --pill:#eef2f7;
    --green:#22c55e; --violet:#8b5cf6; --amber:#f59e0b; --red:#ef4444; --slate:#94a3b8;
  }
  *{box-sizing:border-box}
  body{
    font-family:ui-sans-serif, system-ui, -apple-system, "SF Pro Display", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    background:linear-gradient(#f8faff, #f5f7fb); color:var(--fg); margin:0;
  }
  header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--line);backdrop-filter:saturate(180%) blur(8px)}
  header .inner{max-width:1200px;margin:0 auto;padding:14px 20px;display:flex;gap:8px;align-items:center}
  .brand{font-weight:800;letter-spacing:.2px}
  .spacer{flex:1}
  .btn{padding:10px 14px;border-radius:12px;border:0;background:var(--primary);color:#fff;font-weight:600;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
  .btn.secondary{background:#edf2f7;color:#0f172a}
  .btn.warn{background:var(--red);color:#fff}
  .wrap{max-width:1200px;margin:22px auto;padding:0 16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px;margin-bottom:16px;box-shadow:0 6px 24px rgba(15,23,42,.06)}
  h2{margin:0 0 10px 0}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .chip{padding:6px 10px;border-radius:9999px;background:var(--pill);color:#334155;font-weight:600;font-size:12px;border:1px solid #e5e7eb}
  .muted{color:var(--muted);font-size:13px}
  input,select{padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#f9fafb}
  .quick{display:grid;grid-template-columns:2.2fr 1fr 1fr 1fr 1fr auto;gap:8px}
  @media(max-width:980px){.quick{grid-template-columns:1fr 1fr 1fr 1fr 1fr auto}}
  @media(max-width:720px){.quick{grid-template-columns:1fr 1fr}}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid #f1f5f9;text-align:left;font-size:14px}
  thead th{position:sticky;top:0;background:#fff;z-index:1}
  tbody tr:nth-child(odd){background:#fcfdff}
  .pill{display:inline-block;padding:3px 8px;border-radius:9999px;font-size:12px;font-weight:700}
  .id-pill{background:#eef2f7;color:#374151;border:1px solid #e5e7eb}
  .prio-low{background:#cbd5e1;color:#0f172a}
  .prio-medium{background:#60a5fa;color:#fff}
  .prio-high{background:#f59e0b;color:#fff}
  .prio-critical{background:#ef4444;color:#fff}
  .status-not_started{background:#e2e8f0;color:#0f172a}
  .status-in_progress{background:#8b5cf6;color:#fff}
  .status-blocked{background:#111827;color:#fff}
  .status-done{background:#22c55e;color:#fff}
  .category-pill{padding:3px 8px;border-radius:12px;font-size:12px;font-weight:600;color:#fff}
  .legend .pill.clickable{cursor:pointer;opacity:.95}
  .legend .pill.clickable.active{outline:2px solid var(--primary)}
  .no-data{color:var(--muted);padding:14px;text-align:center}
  /* Timeline */
  #timelineCard .toolbar .btn.secondary.active{background:var(--primary-2);color:#fff}
  #timeline{height:520px;border-radius:14px;border:1px solid var(--line);background:#fff}
  .lane-dot{display:inline-block;width:8px;height:8px;border-radius:999px;margin-right:6px;vertical-align:middle}
  .vis-item .vis-item-content{color:#fff;font-weight:700;padding:2px 8px;border-radius:8px}
  .vis-item.dim .vis-item-content{opacity:.18}
  .vis-selected .vis-item-content{outline:2px solid var(--primary)}
  .vis-time-axis .vis-text{color:#475569}
  .vis-group{cursor:pointer}
  .vis-panel.vis-center,.vis-panel.vis-left{background-image:linear-gradient(to right, rgba(2,6,23,.03) 0 1px, transparent 1px), linear-gradient(to bottom, rgba(2,6,23,.03) 0 1px, transparent 1px); background-size:56px 56px, 100% 42px}
  /* background items */
  .vis-item.vis-background.qbg .vis-item-content{color:#475569;opacity:.25;font-weight:700}
  .vis-item.vis-background.mbg-a{background:rgba(2,6,23,.02);border:none}
  .vis-item.vis-background.mbg-b{background:rgba(2,6,23,.04);border:none}
  /* dependencies overlay */
  #depSvg path.conn{stroke:#475569;stroke-width:1.6;fill:none;stroke-dasharray:4 3}
  #depSvg path.arrow{fill:#475569}
  #depSvg .dim{opacity:.18}
  /* donut */
  #statusMini{width:140px;height:140px}
  .legend-list{display:flex;gap:12px;flex-wrap:wrap}
  .legend-item{display:flex;align-items:center;gap:6px}
  .dot{width:10px;height:10px;border-radius:2px;display:inline-block}
  /* table group headers */
  .group-row{background:#f6f9ff;font-weight:800}
  .group-toggle{cursor:pointer;color:#334155;margin-right:6px}
</style>
</head>
<body>
<header>
  <div class="inner">
    <div class="brand">Focus.One <span class="muted">Lite</span></div>
    <div class="spacer"></div>
    <a class="btn secondary" href="dashboard.html">Dashboard</a>
    <a class="btn secondary" href="review.html">Quarterly Review</a>
    <button id="exportBtn" class="btn secondary">Export</button>
    <button id="importBtn" class="btn secondary">Import</button>
    <button id="addBtn" class="btn">Add Goal</button>
  </div>
</header>

<div class="wrap">

  <!-- TIMELINE -->
  <div id="timelineCard" class="card">
    <div class="toolbar" style="justify-content:space-between;">
      <h2>Timeline</h2>
      <div class="toolbar">
        <label class="muted">Group:</label>
        <select id="groupMode" class="btn secondary">
          <option value="category" selected>Category</option>
          <option value="status">Status</option>
          <option value="none">None</option>
        </select>
        <button class="btn secondary" data-view="Week">Week</button>
        <button class="btn secondary" data-view="1M">1M</button>
        <button class="btn secondary" data-view="6M">6M</button>
        <button class="btn secondary" data-view="YTD">YTD</button>
        <button class="btn secondary" data-view="5Y">5Y</button>
        <button class="btn secondary" data-view="All">All</button>
        <button id="fitBtn" class="btn secondary">Fit</button>
      </div>
    </div>

    <div id="timeline"></div>

    <div class="legend" id="prioLegend" style="margin-top:10px">
      <span class="pill prio-low clickable" data-prio="low">low</span>
      <span class="pill prio-medium clickable" data-prio="medium">medium</span>
      <span class="pill prio-high clickable" data-prio="high">high</span>
      <span class="pill prio-critical clickable" data-prio="critical">critical</span>
      <span id="itemCount" class="muted" style="margin-left:8px"></span>
    </div>
  </div>

  <!-- STATUS -->
  <div class="card">
    <div class="toolbar" style="justify-content:space-between;">
      <h2>Status</h2>
      <div class="toolbar" style="gap:16px;align-items:center">
        <canvas id="statusMini" width="140" height="140"></canvas>
        <div id="statusLegend" class="legend-list"></div>
      </div>
    </div>
  </div>

  <!-- GOALS -->
  <div class="card">
    <div class="toolbar" style="justify-content:space-between;align-items:end;">
      <h2>Goals</h2>
      <div class="toolbar">
        <input id="search" placeholder="Search title or category ( / )" style="min-width:260px">
        <select id="fStatus" class="btn secondary">
          <option value="">All statuses</option>
          <option value="not_started">Not started</option>
          <option value="in_progress">In progress</option>
          <option value="blocked">Blocked</option>
          <option value="done">Done</option>
        </select>
        <select id="fPrio" class="btn secondary">
          <option value="">All priorities</option>
          <option value="low">Low</option><option value="medium">Medium</option>
          <option value="high">High</option><option value="critical">Critical</option>
        </select>
        <div id="yearBtns" class="toolbar"></div>
        <select id="tableGroup" class="btn secondary">
          <option value="category" selected>Group: Category</option>
          <option value="status">Group: Status</option>
          <option value="none">Group: None</option>
        </select>
        <button id="clearBtn" class="btn secondary">Clear</button>
      </div>
    </div>

    <!-- Quick Add -->
    <div class="quick" style="margin:12px 0 8px;">
      <input id="qaTitle" placeholder="Quick add: goal title">
      <input id="qaStart" type="date"><input id="qaDue" type="date">
      <select id="qaPrio"><option>low</option><option selected>medium</option><option>high</option><option>critical</option></select>
      <select id="qaCat"></select>
      <button id="qaAdd" class="btn">Add</button>
    </div>

    <table>
      <thead>
        <tr>
          <th style="width:70px">ID</th><th>Title</th><th>Depends</th>
          <th>Category</th><th>Start</th><th>Due</th><th>Priority</th><th>Status</th>
          <th style="width:140px"></th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

  <div class="muted" style="text-align:center;padding:18px">Data stored locally in your browser.</div>
</div>

<!-- Modal -->
<div id="backdrop" style="display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(15,23,42,.35);backdrop-filter:blur(2px);z-index:30">
  <div class="card" style="width:min(760px,calc(100vw - 24px));">
    <div class="toolbar" style="justify-content:space-between;">
      <h2 id="modalTitle">Add Goal</h2>
      <button id="closeModal" class="btn secondary">Close</button>
    </div>
    <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:12px">
      <div style="grid-column:span 12">
        <label>Title</label><input id="mTitle"><div id="eTitle" class="muted"></div>
      </div>
      <div style="grid-column:span 6"><label>Start date</label><input id="mStart" type="date"><div id="eStart" class="muted"></div></div>
      <div style="grid-column:span 6"><label>Due date</label><input id="mDue" type="date"><div id="eDue" class="muted"></div></div>
      <div style="grid-column:span 6"><label>Category</label><select id="mCat"></select></div>
      <div style="grid-column:span 6"><label>Depends on</label><select id="mDep"><option value="">None</option></select></div>
      <div style="grid-column:span 6"><label>Priority</label><select id="mPrio"><option>low</option><option selected>medium</option><option>high</option><option>critical</option></select></div>
      <div style="grid-column:span 6"><label>Status</label><select id="mStatus"><option>not_started</option><option>in_progress</option><option>blocked</option><option>done</option></select></div>
    </div>
    <div class="toolbar" style="justify-content:flex-end;margin-top:10px">
      <button id="saveGoal" class="btn" disabled>Save</button>
    </div>
  </div>
</div>

<script>
/* ---------- Storage & helpers ---------- */
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
const GKEY='focusone_goals', CKEY='focusone_categories';
const uid=()=> 'g_'+Math.random().toString(36).slice(2,9);
const esc=s=>(s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
const pad=n=>String(n).padStart(2,'0'); const iso=d=>`${d.getFull
