<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FocusOne – Dashboard</title>

  <!-- Minimal reset + nice fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#fafafa; --panel:#ffffff; --text:#111827; --muted:#6b7280; --line:#e5e7eb;
      --prio-low:#E5F4FF; --prio-med:#FFEFD5; --prio-high:#FFE5E5;
      --accent:#111827;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    .toolbar{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:12px}
    .h1{font-weight:600;font-size:18px}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 12px;font-weight:500;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:12px}
    .grid{display:grid;grid-template-columns:1.35fr 1fr;gap:12px}
    @media (max-width: 900px){ .grid{grid-template-columns:1fr} }

    /* vis-timeline theming hooks */
    .vis-timeline{border:none}
    .vis-item .vis-item-content{padding:4px 8px;font-size:12px;border-radius:8px}
    .vis-group{color:var(--muted);font-weight:600}
    .tl-prio-low  .vis-item-content{background:var(--prio-low)}
    .tl-prio-med  .vis-item-content{background:var(--prio-med)}
    .tl-prio-high .vis-item-content{background:var(--prio-high)}
    .tl-done      .vis-item-content{opacity:.55;text-decoration:line-through}
    .tl-risk      .vis-item-content{outline:2px dashed #f59e0b}
    .tl-overdue   .vis-item-content{outline:2px solid #ef4444}
    .list li{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--line)}
    .list li:last-child{border-bottom:0}
    .badge{font-size:11px;color:#374151;background:#F3F4F6;border:1px solid var(--line);padding:2px 8px;border-radius:999px}
    .summary{display:flex;gap:8px}
    .chip{font-size:12px;border:1px solid var(--line);padding:6px 10px;border-radius:999px;background:#fff;cursor:pointer}
    .chip[data-variant="overdue"]{border-color:#ef4444;color:#ef4444}
  </style>

  <!-- vis-timeline (CDN, no build tools needed) -->
  <link rel="stylesheet" href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css">
  <script src="https://unpkg.com/vis-data@latest/peer/umd/vis-data.min.js"></script>
  <script src="https://unpkg.com/vis-timeline@latest/peer/umd/vis-timeline-graph2d.min.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="toolbar">
      <div class="h1">Dashboard</div>
      <div style="display:flex;gap:8px">
        <select id="filter" class="btn">
          <option value="all">All</option>
          <option value="open">On Track</option>
          <option value="at_risk">At Risk</option>
          <option value="overdue">Overdue</option>
          <option value="done">Done</option>
        </select>
        <button class="btn" id="fitBtn">Fit</button>
        <button class="btn" id="resetBtn">Reset Demo</button>
      </div>
    </div>

    <div class="summary" id="summary"></div>

    <div class="grid">
      <div class="panel">
        <div id="timeline" style="height:420px"></div>
      </div>

      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
          <strong>Goals</strong>
          <button class="btn" id="addBtn">+ Add</button>
        </div>
        <ul id="list" class="list"></ul>
      </div>
    </div>
  </div>

  <script>
    // ---------- demo data ----------
    const LEVELS = ['strategy','vision','tactical','project','daily'];
    const demo = [
      { id:'g1', title:'Define Life Vision',   level:'strategy', priority:'high', status:'open',    start:'2025-01-01', end:'2025-03-01' },
      { id:'g2', title:'MVP Timeline v1',      level:'project',  priority:'high', status:'at_risk', start:today(-7),   end:today(10) },
      { id:'g3', title:'A2 German Course',     level:'tactical', priority:'med',  status:'open',    start:'2025-02-10', end:'2025-05-15' },
      { id:'g4', title:'Daily German 20m',     level:'daily',    priority:'low',  status:'open',    start:today(0),    end:today(60) },
      { id:'g5', title:'Quarterly Review Q4',  level:'vision',   priority:'med',  status:'open',    start:'2025-12-20', end:'2025-12-31' },
      { id:'g6', title:'Refactor UI polish',   level:'project',  priority:'med',  status:'overdue', start:today(-30),  end:today(-10) },
    ];

    function today(offsetDays){ const d=new Date(); d.setDate(d.getDate()+offsetDays); return d.toISOString().slice(0,10); }
    function save(list){ localStorage.setItem('goals', JSON.stringify(list)); }
    function load(){ try{ return JSON.parse(localStorage.getItem('goals')) || demo } catch{ return demo } }
    let goals = load();

    // ---------- timeline init ----------
    const groups = new vis.DataSet(LEVELS.map((lvl,i)=>({ id:lvl, content:lvl.toUpperCase(), order:i })));
    const ds = new vis.DataSet();
    const container = document.getElementById('timeline');
    const tl = new vis.Timeline(container, ds, groups, {
      stack:true,
      horizontalScroll:true,
      zoomKey:'ctrlKey',
      zoomMin: 24*60*60*1000,            // 1 day
      zoomMax: 5*365*24*60*60*1000,      // 5 years
      showCurrentTime:true,
      minHeight:'420px', maxHeight:'420px',
      margin:{ item:10, axis:18 },
      orientation:'top',
      timeAxis:{ scale:'month', step:1 },
      selectable:true,
      tooltip: { followMouse:true, overflowMethod:'cap' }
    });

    function classFor(g){
      const pr = g.priority==='high' ? 'tl-prio-high' : g.priority==='med' ? 'tl-prio-med' : 'tl-prio-low';
      const st = g.status==='done' ? 'tl-done' : g.status==='at_risk' ? 'tl-risk' : g.status==='overdue' ? 'tl-overdue' : '';
      return `${pr} ${st}`;
    }
    function renderTimeline(items){
      const mapped = items.map(g=>({
        id:g.id, group:g.level, start:g.start, end:g.end,
        content:`<div title="${escapeHtml(g.title)}">${escapeHtml(trunc(g.title,28))}</div>`,
        className: classFor(g)
      }));
      ds.update(mapped);
      const currentIds = new Set(mapped.map(m=>m.id));
      ds.getIds().forEach(id=>{ if(!currentIds.has(id)) ds.remove(id); });
    }

    // ---------- list + summary ----------
    const listEl = document.getElementById('list');
    const summaryEl = document.getElementById('summary');

    function renderList(items){
      listEl.innerHTML = '';
      items.forEach(g=>{
        const li = document.createElement('li');
        li.innerHTML = `
          <span class="badge">${g.level}</span>
          <span style="flex:1;min-width:0" title="${escapeHtml(g.title)}">${escapeHtml(g.title)}</span>
          <select data-act="status" data-id="${g.id}" class="btn" style="padding:4px 8px">
            <option value="open" ${g.status==='open'?'selected':''}>On Track</option>
            <option value="at_risk" ${g.status==='at_risk'?'selected':''}>At Risk</option>
            <option value="overdue" ${g.status==='overdue'?'selected':''}>Overdue</option>
            <option value="done" ${g.status==='done'?'selected':''}>Done</option>
          </select>
          <button class="btn" data-act="del" data-id="${g.id}">Delete</button>
        `;
        listEl.appendChild(li);
      });
    }

    function renderSummary(items){
      const counts = {
        done: items.filter(x=>x.status==='done').length,
        open: items.filter(x=>x.status==='open').length,
        at_risk: items.filter(x=>x.status==='at_risk').length,
        overdue: items.filter(x=>x.status==='overdue').length
      };
      summaryEl.innerHTML = `
        <div class="chip" data-filter="all">All: ${items.length}</div>
        <div class="chip" data-filter="open">On Track: ${counts.open}</div>
        <div class="chip" data-filter="at_risk">At Risk: ${counts.at_risk}</div>
        <div class="chip" data-filter="overdue" data-variant="overdue">Overdue: ${counts.overdue}</div>
        <div class="chip" data-filter="done">Done: ${counts.done}</div>
      `;
    }

    // ---------- interactions ----------
    function applyFilter(value){
      let filtered = goals;
      if(value!=='all'){ filtered = goals.filter(g=>g.status===value); }
      renderTimeline(filtered);
      renderList(filtered);
      renderSummary(goals);
    }

    document.getElementById('filter').addEventListener('change', e=>applyFilter(e.target.value));
    document.getElementById('fitBtn').addEventListener('click', ()=> tl.fit({ animation:{ duration:300, easingFunction:'easeInOutQuad' } }));
    document.getElementById('resetBtn').addEventListener('click', ()=>{ localStorage.removeItem('goals'); goals = load(); applyFilter(document.getElementById('filter').value) });
    document.getElementById('addBtn').addEventListener('click', ()=>{
      const id = crypto.randomUUID();
      const start = today(0); const end = today(14);
      const g = { id, title:'New Goal', level:'project', priority:'med', status:'open', start, end };
      goals = [...goals, g]; save(goals); applyFilter(document.getElementById('filter').value);
    });

    listEl.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-act="del"]');
      if(!btn) return;
      const id = btn.dataset.id;
      goals = goals.filter(g=>g.id!==id); save(goals); applyFilter(document.getElementById('filter').value);
    });
    listEl.addEventListener('change', (e)=>{
      const sel = e.target.closest('select[data-act="status"]');
      if(!sel) return;
      const id = sel.dataset.id;
      goals = goals.map(g=> g.id===id ? {...g, status: sel.value} : g ); save(goals); applyFilter(document.getElementById('filter').value);
    });

    // ---------- utils & first render ----------
    function trunc(s,n){ return s.length>n ? s.slice(0,n-1)+'…' : s }
    function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) }
    renderTimeline(goals);
    renderList(goals);
    renderSummary(goals);
    tl.fit({ animation:{ duration:300, easingFunction:'easeInOutQuad' } });
  </script>
</body>
</html>
